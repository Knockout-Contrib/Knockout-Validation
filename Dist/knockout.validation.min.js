!function(a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(ko,ko.validation={})}(function(a,b){function c(a,c,d){if(c.validator(a(),void 0===d.params?!0:d.params))return!0;var e=b.formatMessage(d.message||c.message,d.params);return a.errorData({message:e,context:d,rule:c}),a.error(e),a.__valid__(!1),!1}function d(a,c,d){a.isValidating(!0);var e=function(e){var f=!1,g="";if(!a.__valid__())return a.isValidating(!1),void 0;if(e.message?(f=e.isValid,g=e.message):f=e,!f){var h=b.formatMessage(d.message||c.message,d.params);a.errorData({message:h,context:d,rule:c}),a.error(h),a.__valid__(f)}a.isValidating(!1)};c.validator(a(),d.params||!0,e)}if(void 0===typeof a)throw"Knockout is required, please ensure it is loaded before loading this validation plug-in";var e=b;a.validation=e;var f={registerExtenders:!0,messagesOnModified:!0,errorsAsTitle:!0,errorsAsTitleOnModified:!1,messageTemplate:null,insertMessages:!0,parseInputAttributes:!1,writeInputAttributes:!1,decorateElement:!1,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",grouping:{deep:!1,observable:!0}},g=a.utils.extend({},f),h=["required","pattern","min","max","step"],i=["email","number","date"],j=function(a){window.setImmediate?window.setImmediate(a):window.setTimeout(a,0)},k=function(){var a=(new Date).getTime(),b={},c="__ko_validation__";return{isArray:function(a){return a.isArray||"[object Array]"===Object.prototype.toString.call(a)},isObject:function(a){return null!==a&&"object"==typeof a},values:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},getValue:function(a){return"function"==typeof a?a():a},hasAttribute:function(a,b){return null!==a.getAttribute(b)},getAttribute:function(a,b){return a.getAttribute(b)},setAttribute:function(a,b,c){return a.setAttribute(b,c)},isValidatable:function(a){return a&&a.rules&&a.isValid&&a.isModified},insertAfter:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},newId:function(){return a+=1},getConfigOptions:function(a){var b=k.contextFor(a);return b||g},setDomData:function(a,d){var e=a[c];e||(a[c]=e=k.newId()),b[e]=d},getDomData:function(a){var d=a[c];return d?b[d]:void 0},contextFor:function(a){switch(a.nodeType){case 1:case 8:var b=k.getDomData(a);if(b)return b;if(a.parentNode)return k.contextFor(a.parentNode)}return void 0},isEmptyVal:function(a){return void 0===a?!0:null===a?!0:""===a?!0:void 0},getOriginalElementTitle:function(a){var b=k.getAttribute(a,"data-orig-title"),c=a.title,d=k.hasAttribute(a,"data-orig-title");return d?b:c}}}(),l=function(){var c=0;return{utils:k,init:function(d,e){c>0&&!e||(d=d||{},d.errorElementClass=d.errorElementClass||d.errorClass||g.errorElementClass,d.errorMessageClass=d.errorMessageClass||d.errorClass||g.errorMessageClass,a.utils.extend(g,d),g.registerExtenders&&b.registerExtenders(),c=1)},configure:function(a){b.init(a)},reset:function(){g=jQuery.extend(g,f)},group:function(b,c){c=a.utils.extend(a.utils.extend({},g.grouping),c);var d=a.observableArray([]),e=null,f=function h(b,e){var f=[],g=a.utils.unwrapObservable(b);e=void 0!==e?e:c.deep?1:-1,a.isObservable(b)&&(b.isValid||b.extend({validatable:!0}),d.push(b)),g&&(k.isArray(g)?f=g:k.isObject(g)&&(f=k.values(g))),0!==e&&a.utils.arrayForEach(f,function(a){a&&!a.nodeType&&h(a,e+1)})};return c.observable?(f(b),e=a.computed(function(){var b=[];return a.utils.arrayForEach(d(),function(a){a.isValid()||b.push(a.error)}),b})):e=function(){var c=[];return d([]),f(b),a.utils.arrayForEach(d(),function(a){a.isValid()||c.push(a.error)}),c},e.showAllMessages=function(b){void 0===b&&(b=!0),e(),a.utils.arrayForEach(d(),function(a){a.isModified(b)})},b.errors=e,b.isValid=function(){return 0===b.errors().length},b.isAnyMessageShown=function(){var b=!1;return e(),a.utils.arrayForEach(d(),function(a){!a.isValid()&&a.isModified()&&(b=!0)}),b},e},formatMessage:function(b,c){return"function"==typeof b?b(c):b.replace(/\{0\}/gi,a.utils.unwrapObservable(c))},addRule:function(a,b){return a.extend({validatable:!0}),a.rules.push(b),a},addAnonymousRule:function(a,c){var d=k.newId();void 0===c.message&&(c.message="Error"),b.rules[d]=c,b.addRule(a,{rule:d,params:c.params})},addExtender:function(c){a.extenders[c]=function(a,d){return d.message||d.onlyIf||d.customClass?b.addRule(a,{rule:c,message:d.message,customClass:d.customClass,params:k.isEmptyVal(d.params)?!0:d.params,condition:d.onlyIf}):b.addRule(a,{rule:c,params:d})}},registerExtenders:function(){if(g.registerExtenders)for(var c in b.rules)b.rules.hasOwnProperty(c)&&(a.extenders[c]||b.addExtender(c))},insertValidationMessage:function(a){var b=document.createElement("SPAN");return b.className=k.getConfigOptions(a).errorMessageClass,k.insertAfter(a,b),b},parseInputValidationAttributes:function(c,d){a.utils.arrayForEach(h,function(a){k.hasAttribute(c,a)&&b.addRule(d(),{rule:a,params:c.getAttribute(a)||!0})});var e=c.getAttribute("type");a.utils.arrayForEach(i,function(a){a===e&&b.addRule(d(),{rule:"date"===a?"dateISO":a,params:!0})})},writeInputValidationAttributes:function(b,c){var d=c();if(d&&d.rules){var e=d.rules();a.utils.arrayForEach(h,function(c){var d,f=a.utils.arrayFirst(e,function(a){return a.rule.toLowerCase()===c.toLowerCase()});f&&(d=f.params,"pattern"===f.rule&&f.params instanceof RegExp&&(d=f.params.source),b.setAttribute(c,d))}),e=null}},makeBindingHandlerValidatable:function(b){var c=a.bindingHandlers[b].init;a.bindingHandlers[b].init=function(b,d,e,f,g){return c(b,d,e),a.bindingHandlers.validationCore.init(b,d,e,f,g)}}}}();a.utils.extend(e,l),e.rules={},e.rules.required={validator:function(a,b){var c,d=/^\s+|\s+$/g;return void 0===a||null===a?!b:(c=a,"string"==typeof a&&(c=a.replace(d,"")),b?(c+"").length>0:!0)},message:"This field is required."},e.rules.min={validator:function(a,b){return k.isEmptyVal(a)||a>=b},message:"Please enter a value greater than or equal to {0}."},e.rules.max={validator:function(a,b){return k.isEmptyVal(a)||b>=a},message:"Please enter a value less than or equal to {0}."},e.rules.minLength={validator:function(a,b){return k.isEmptyVal(a)||a.length>=b},message:"Please enter at least {0} characters."},e.rules.maxLength={validator:function(a,b){return k.isEmptyVal(a)||a.length<=b},message:"Please enter no more than {0} characters."},e.rules.pattern={validator:function(a,b){return k.isEmptyVal(a)||null!==a.toString().match(b)},message:"Please check this value."},e.rules.step={validator:function(a,b){if(k.isEmptyVal(a)||"any"==b)return!0;var c=100*a%(100*b);return Math.abs(c)<1e-5||Math.abs(1-c)<1e-5},message:"The value must increment by {0}"},e.rules.email={validator:function(a,b){return b?k.isEmptyVal(a)||b&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a):!0},message:"Please enter a proper email address"},e.rules.date={validator:function(a,b){return b?k.isEmptyVal(a)||b&&!/Invalid|NaN/.test(new Date(a)):!0},message:"Please enter a proper date"},e.rules.dateISO={validator:function(a,b){return b?k.isEmptyVal(a)||b&&/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(a):!0},message:"Please enter a proper date"},e.rules.number={validator:function(a,b){return b?k.isEmptyVal(a)||b&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(a):!0},message:"Please enter a number"},e.rules.digit={validator:function(a,b){return b?k.isEmptyVal(a)||b&&/^\d+$/.test(a):!0},message:"Please enter a digit"},e.rules.phoneUS={validator:function(a,b){return b?"string"!=typeof a?!1:k.isEmptyVal(a)?!0:(a=a.replace(/\s+/g,""),b&&a.length>9&&a.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)):!0},message:"Please specify a valid phone number"},e.rules.equal={validator:function(a,b){var c=b;return a===k.getValue(c)},message:"Values must equal"},e.rules.notEqual={validator:function(a,b){var c=b;return a!==k.getValue(c)},message:"Please choose another value."},e.rules.unique={validator:function(b,c){var d=k.getValue(c.collection),e=k.getValue(c.externalValue),f=0;return b&&d?(a.utils.arrayFilter(a.utils.unwrapObservable(d),function(a){b===(c.valueAccessor?c.valueAccessor(a):a)&&f++}),(void 0!==e&&b!==e?1:2)>f):!0},message:"Please make sure the value is unique."},function(){e.registerExtenders()}(),a.bindingHandlers.validationCore=function(){return{init:function(c,d){var e=k.getConfigOptions(c);if(e.parseInputAttributes&&j(function(){b.parseInputValidationAttributes(c,d)}),e.insertMessages&&k.isValidatable(d())){var f=b.insertValidationMessage(c);e.messageTemplate?a.renderTemplate(e.messageTemplate,{field:d()},null,f,"replaceNode"):a.applyBindingsToNode(f,{validationMessage:d()})}e.writeInputAttributes&&k.isValidatable(d())&&b.writeInputValidationAttributes(c,d),e.decorateElement&&k.isValidatable(d())&&a.applyBindingsToNode(c,{validationElement:d()})},update:function(){}}}(),l.makeBindingHandlerValidatable("value"),l.makeBindingHandlerValidatable("checked"),a.bindingHandlers.validationMessage={update:function(b,c){var d=c(),e=k.getConfigOptions(b),f=(a.utils.unwrapObservable(d),!1),g=!1;d.extend({validatable:!0}),f=d.isModified(),g=d.isValid();var h=function(){return!e.messagesOnModified||f?g?null:d.error:null},i=function(){return!e.messagesOnModified||f?g||!d.errorData()?null:d.errorData().context.customClass:null},j=function(){return!e.messagesOnModified||f?!g:!1};a.bindingHandlers.text.update(b,h),a.bindingHandlers.css.update(b,i),a.bindingHandlers.visible.update(b,j)}},a.bindingHandlers.validationElement={update:function(b,c){var d=c(),e=k.getConfigOptions(b),f=(a.utils.unwrapObservable(d),!1),g=!1;d.extend({validatable:!0}),f=d.isModified(),g=d.isValid();var h=function(){var a={},b=f?!g:!1;e.decorateElement||(b=!1),a[e.errorElementClass]=b,d.lastCustomClass&&(a[d.lastCustomClass]=!1);var c=d.errorData()&&d.errorData().context.customClass;return c&&(d.lastCustomClass=c,a[d.lastCustomClass]=b),a};if(a.bindingHandlers.css.update(b,h),e.errorsAsTitle){k.getAttribute(b,"data-orig-title"),b.title,"true"===k.getAttribute(b,"data-orig-title");var i=function(){return!e.errorsAsTitleOnModified||f?g?{title:k.getOriginalElementTitle(b),"data-orig-title":null}:{title:d.error,"data-orig-title":k.getOriginalElementTitle(b)}:void 0};a.bindingHandlers.attr.update(b,i)}}},a.bindingHandlers.validationOptions=function(){return{init:function(b,c){var d=a.utils.unwrapObservable(c());if(d){var e=a.utils.extend({},g);a.utils.extend(e,d),k.setDomData(b,e)}}}}(),a.extenders.validation=function(c,d){return a.utils.arrayForEach(k.isArray(d)?d:[d],function(a){b.addAnonymousRule(c,a)}),c},a.extenders.validatable=function(c,d){if(d&&!k.isValidatable(c)){c.error=a.observable(null),c.errorData=a.observable(null),c.rules=a.observableArray(),c.isValidating=a.observable(!1),c.__valid__=a.observable(!0),c.isModified=a.observable(!1);var e=a.computed(function(){return c(),c.rules(),b.validateObservable(c),!0});c.isValid=a.computed(function(){return c.__valid__()}),c.setError=function(a){"string"==typeof a&&(a={message:a}),c.errorData(a),c.error(a.message),c.__valid__(!1)},c.clearError=function(){c.errorData(null),c.error(null),c.__valid__(!0)};var f=c.subscribe(function(){c.isModified(!0)});c._disposeValidation=function(){c.isValid.dispose(),c.rules.removeAll(),c.isModified._subscriptions.change=[],c.isValidating._subscriptions.change=[],c.__valid__._subscriptions.change=[],f.dispose(),e.dispose(),delete c.rules,delete c.error,delete c.errorData,delete c.isValid,delete c.isValidating,delete c.__valid__,delete c.isModified}}else d===!1&&k.isValidatable(c)&&c._disposeValidation&&c._disposeValidation();return c},e.validateObservable=function(a){for(var e,f,g=0,h=a.rules(),i=h.length;i>g;g++)if(f=h[g],!f.condition||f.condition())if(e=b.rules[f.rule],e.async||f.async)d(a,e,f);else if(!c(a,e,f))return!1;return a.error(null),a.errorData(null),a.__valid__(!0),!0},a.validatedObservable=function(c){if(!b.utils.isObject(c))return a.observable(c).extend({validatable:!0});var d=a.observable(c);return d.errors=b.group(c),d.isValid=a.computed(function(){return 0===d.errors().length}),d},e.localize=function(a){var c;for(c in a)b.rules.hasOwnProperty(c)&&(b.rules[c].message=a[c])},a.applyBindingsWithValidation=function(c,d,e){var f,g,h=arguments.length;h>2?(f=d,g=e):2>h?f=document.body:arguments[1].nodeType?f=d:g=arguments[1],b.init(),g&&b.utils.setDomData(f,g),a.applyBindings(c,d)};var m=a.applyBindings;a.applyBindings=function(a,c){b.init(),m(a,c)}});