/*=============================================================================
	Author:			Eric M. Barnard - @ericmbarnard								
	License:		MIT (http://opensource.org/licenses/mit-license.php)		
																				
	Description:	Validation Library for KnockoutJS							
===============================================================================
*/
!function(a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(ko,ko.validation={})}(function(a,b){function c(b,c,d){return c.validator(b(),void 0===d.params?!0:d.params)?!0:(b.error(a.validation.formatMessage(d.message||c.message,d.params)),b.__valid__(!1),!1)}function d(b,c,d){b.isValidating(!0);var e=function(e){var f=!1,g="";return b.__valid__()?(e.message?(f=e.isValid,g=e.message):f=e,f||(b.error(a.validation.formatMessage(g||d.message||c.message,d.params)),b.__valid__(f)),b.isValidating(!1),void 0):(b.isValidating(!1),void 0)};c.validator(b(),d.params||!0,e)}if(void 0===typeof a)throw"Knockout is required, please ensure it is loaded before loading this validation plug-in";a.validation=b;var e={registerExtenders:!0,messagesOnModified:!0,errorsAsTitle:!0,errorsAsTitleOnModified:!1,messageTemplate:null,insertMessages:!0,parseInputAttributes:!1,writeInputAttributes:!1,decorateElement:!1,decorateElementOnModified:!0,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",grouping:{deep:!1,observable:!0}},f=a.utils.extend({},e);f.html5Attributes=["required","pattern","min","max","step"],f.html5InputTypes=["email","number","date"],f.reset=function(){a.utils.extend(f,e)},a.validation.configuration=f,a.validation.utils=function(){var b=(new Date).getTime(),c={},d="__ko_validation__";return{isArray:function(a){return a.isArray||"[object Array]"===Object.prototype.toString.call(a)},isObject:function(a){return null!==a&&"object"==typeof a},values:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},getValue:function(a){return"function"==typeof a?a():a},hasAttribute:function(a,b){return null!==a.getAttribute(b)},getAttribute:function(a,b){return a.getAttribute(b)},setAttribute:function(a,b,c){return a.setAttribute(b,c)},isValidatable:function(a){return a&&a.rules&&a.isValid&&a.isModified},insertAfter:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},newId:function(){return b+=1},getConfigOptions:function(b){var c=a.validation.utils.contextFor(b);return c||a.validation.configuration},setDomData:function(b,e){var f=b[d];f||(b[d]=f=a.validation.utils.newId()),c[f]=e},getDomData:function(a){var b=a[d];return b?c[b]:void 0},contextFor:function(b){switch(b.nodeType){case 1:case 8:var c=a.validation.utils.getDomData(b);if(c)return c;if(b.parentNode)return a.validation.utils.contextFor(b.parentNode)}return void 0},isEmptyVal:function(a){return void 0===a?!0:null===a?!0:""===a?!0:void 0},getOriginalElementTitle:function(b){var c=a.validation.utils.getAttribute(b,"data-orig-title"),d=b.title,e=a.validation.utils.hasAttribute(b,"data-orig-title");return e?c:d},async:function(a){window.setImmediate?window.setImmediate(a):window.setTimeout(a,0)}}}();var g=function(){var b=0,c=a.validation.configuration,d=a.validation.utils;return{init:function(d,e){b>0&&!e||(d=d||{},d.errorElementClass=d.errorElementClass||d.errorClass||c.errorElementClass,d.errorMessageClass=d.errorMessageClass||d.errorClass||c.errorMessageClass,a.utils.extend(c,d),c.registerExtenders&&a.validation.registerExtenders(),b=1)},configure:function(b){a.validation.init(b)},reset:a.validation.configuration.reset,group:function(b,e){e=a.utils.extend(a.utils.extend({},c.grouping),e);var f=a.observableArray([]),g=null,h=function i(b,c){var g=[],h=a.utils.unwrapObservable(b);c=void 0!==c?c:e.deep?1:-1,a.isObservable(b)&&(b.isValid||b.extend({validatable:!0}),f.push(b)),h&&(d.isArray(h)?g=h:d.isObject(h)&&(g=d.values(h))),0!==c&&a.utils.arrayForEach(g,function(a){a&&!a.nodeType&&i(a,c+1)})};return e.observable?(h(b),g=a.computed(function(){var b=[];return a.utils.arrayForEach(f(),function(a){a.isValid()||b.push(a.error)}),b})):g=function(){var c=[];return f([]),h(b),a.utils.arrayForEach(f(),function(a){a.isValid()||c.push(a.error)}),c},g.showAllMessages=function(b){void 0===b&&(b=!0),g(),a.utils.arrayForEach(f(),function(a){a.isModified(b)})},b.errors=g,b.isValid=function(){return 0===b.errors().length},b.isAnyMessageShown=function(){var b=!1;return g(),a.utils.arrayForEach(f(),function(a){!a.isValid()&&a.isModified()&&(b=!0)}),b},g},formatMessage:function(b,c){return"function"==typeof b?b(c):b.replace(/\{0\}/gi,a.utils.unwrapObservable(c))},addRule:function(a,b){return a.extend({validatable:!0}),a.rules.push(b),a},addAnonymousRule:function(b,c){var e=d.newId();void 0===c.message&&(c.message="Error"),a.validation.rules[e]=c,a.validation.addRule(b,{rule:e,params:c.params})},addExtender:function(b){a.extenders[b]=function(c,e){return e.message||e.onlyIf?a.validation.addRule(c,{rule:b,message:e.message,params:d.isEmptyVal(e.params)?!0:e.params,condition:e.onlyIf}):a.validation.addRule(c,{rule:b,params:e})}},registerExtenders:function(){if(c.registerExtenders)for(var b in a.validation.rules)a.validation.rules.hasOwnProperty(b)&&(a.extenders[b]||a.validation.addExtender(b))},insertValidationMessage:function(a){var b=document.createElement("SPAN");return b.className=d.getConfigOptions(a).errorMessageClass,d.insertAfter(a,b),b},parseInputValidationAttributes:function(b,c){a.utils.arrayForEach(a.validation.configuration.html5Attributes,function(e){d.hasAttribute(b,e)&&a.validation.addRule(c(),{rule:e,params:b.getAttribute(e)||!0})});var e=b.getAttribute("type");a.utils.arrayForEach(a.validation.configuration.html5InputTypes,function(b){b===e&&a.validation.addRule(c(),{rule:"date"===b?"dateISO":b,params:!0})})},writeInputValidationAttributes:function(b,c){var d=c();if(d&&d.rules){var e=d.rules();a.utils.arrayForEach(a.validation.configuration.html5Attributes,function(c){var d,f=a.utils.arrayFirst(e,function(a){return a.rule.toLowerCase()===c.toLowerCase()});f&&(d=f.params,"pattern"===f.rule&&f.params instanceof RegExp&&(d=f.params.source),b.setAttribute(c,d))}),e=null}},makeBindingHandlerValidatable:function(b){var c=a.bindingHandlers[b].init;a.bindingHandlers[b].init=function(b,d,e,f,g){return c(b,d,e,f,g),a.bindingHandlers.validationCore.init(b,d,e,f,g)}}}}();a.utils.extend(a.validation,g),a.validation.rules={},a.validation.rules.required={validator:function(a,b){var c,d=/^\s+|\s+$/g;return void 0===a||null===a?!b:(c=a,"string"==typeof a&&(c=a.replace(d,"")),b?(c+"").length>0:!0)},message:"This field is required."},a.validation.rules.min={validator:function(b,c){return a.validation.utils.isEmptyVal(b)||b>=c},message:"Please enter a value greater than or equal to {0}."},a.validation.rules.max={validator:function(b,c){return a.validation.utils.isEmptyVal(b)||c>=b},message:"Please enter a value less than or equal to {0}."},a.validation.rules.minLength={validator:function(b,c){return a.validation.utils.isEmptyVal(b)||b.length>=c},message:"Please enter at least {0} characters."},a.validation.rules.maxLength={validator:function(b,c){return a.validation.utils.isEmptyVal(b)||b.length<=c},message:"Please enter no more than {0} characters."},a.validation.rules.pattern={validator:function(b,c){return a.validation.utils.isEmptyVal(b)||null!==b.toString().match(c)},message:"Please check this value."},a.validation.rules.step={validator:function(b,c){if(a.validation.utils.isEmptyVal(b)||"any"===c)return!0;var d=100*b%(100*c);return Math.abs(d)<1e-5||Math.abs(1-d)<1e-5},message:"The value must increment by {0}"},a.validation.rules.email={validator:function(b,c){return c?a.validation.utils.isEmptyVal(b)||c&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(b):!0},message:"Please enter a proper email address"},a.validation.rules.date={validator:function(b,c){return c?a.validation.utils.isEmptyVal(b)||c&&!/Invalid|NaN/.test(new Date(b)):!0},message:"Please enter a proper date"},a.validation.rules.dateISO={validator:function(b,c){return c?a.validation.utils.isEmptyVal(b)||c&&/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(b):!0},message:"Please enter a proper date"},a.validation.rules.number={validator:function(b,c){return c?a.validation.utils.isEmptyVal(b)||c&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(b):!0},message:"Please enter a number"},a.validation.rules.digit={validator:function(b,c){return c?a.validation.utils.isEmptyVal(b)||c&&/^\d+$/.test(b):!0},message:"Please enter a digit"},a.validation.rules.phoneUS={validator:function(b,c){return c?"string"!=typeof b?!1:a.validation.utils.isEmptyVal(b)?!0:(b=b.replace(/\s+/g,""),c&&b.length>9&&b.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)):!0},message:"Please specify a valid phone number"},a.validation.rules.equal={validator:function(b,c){var d=c;return b===a.validation.utils.getValue(d)},message:"Values must equal"},a.validation.rules.notEqual={validator:function(b,c){var d=c;return b!==a.validation.utils.getValue(d)},message:"Please choose another value."},a.validation.rules.unique={validator:function(b,c){var d=a.validation.utils.getValue(c.collection),e=a.validation.utils.getValue(c.externalValue),f=0;return b&&d?(a.utils.arrayFilter(a.utils.unwrapObservable(d),function(a){b===(c.valueAccessor?c.valueAccessor(a):a)&&f++}),(void 0!==e&&b!==e?1:2)>f):!0},message:"Please make sure the value is unique."},function(){a.validation.registerExtenders()}(),a.bindingHandlers.validationCore=function(){return{init:function(b,c){var d=a.validation.utils.getConfigOptions(b);if(d.parseInputAttributes&&a.validation.utils.async(function(){a.validation.parseInputValidationAttributes(b,c)}),d.insertMessages&&a.validation.utils.isValidatable(c())){var e=a.validation.insertValidationMessage(b);d.messageTemplate?a.renderTemplate(d.messageTemplate,{field:c()},null,e,"replaceNode"):a.applyBindingsToNode(e,{validationMessage:c()})}d.writeInputAttributes&&a.validation.utils.isValidatable(c())&&a.validation.writeInputValidationAttributes(b,c),d.decorateElement&&a.validation.utils.isValidatable(c())&&a.applyBindingsToNode(b,{validationElement:c()})},update:function(){}}}(),a.validation.makeBindingHandlerValidatable("value"),a.validation.makeBindingHandlerValidatable("checked"),a.bindingHandlers.validationMessage={update:function(b,c){var d=c(),e=a.validation.utils.getConfigOptions(b),f=(a.utils.unwrapObservable(d),!1),g=!1;d.extend({validatable:!0}),f=d.isModified(),g=d.isValid();var h=function(){return!e.messagesOnModified||f?g?null:d.error:null},i=function(){return!e.messagesOnModified||f?!g:!1};a.bindingHandlers.text.update(b,h),a.bindingHandlers.visible.update(b,i)}},a.bindingHandlers.validationElement={update:function(b,c){var d=c(),e=a.validation.utils.getConfigOptions(b),f=(a.utils.unwrapObservable(d),!1),g=!1;d.extend({validatable:!0}),f=d.isModified(),g=d.isValid();var h=function(){var a={},b=!e.decorateElementOnModified||f?!g:!1;return e.decorateElement||(b=!1),a[e.errorElementClass]=b,a};if(a.bindingHandlers.css.update(b,h),e.errorsAsTitle){a.validation.utils.getAttribute(b,"data-orig-title"),b.title,"true"===a.validation.utils.getAttribute(b,"data-orig-title");var i=function(){return!e.errorsAsTitleOnModified||f?g?{title:a.validation.utils.getOriginalElementTitle(b),"data-orig-title":null}:{title:d.error,"data-orig-title":a.validation.utils.getOriginalElementTitle(b)}:void 0};a.bindingHandlers.attr.update(b,i)}}},a.bindingHandlers.validationOptions=function(){return{init:function(b,c){var d=a.utils.unwrapObservable(c());if(d){var e=a.utils.extend({},a.validation.configuration);a.utils.extend(e,d),a.validation.utils.setDomData(b,e)}}}}(),a.extenders.validation=function(b,c){return a.utils.arrayForEach(a.validation.utils.isArray(c)?c:[c],function(c){a.validation.addAnonymousRule(b,c)}),b},a.extenders.validatable=function(b,c){if(c&&!a.validation.utils.isValidatable(b)){b.error=a.observable(null),b.rules=a.observableArray(),b.isValidating=a.observable(!1),b.__valid__=a.observable(!0),b.isModified=a.observable(!1);var d=a.computed(function(){return b(),b.rules(),a.validation.validateObservable(b),!0});b.isValid=a.computed(function(){return b.__valid__()}),b.setError=function(a){b.error(a),b.__valid__(!1)},b.clearError=function(){b.error(null),b.__valid__(!0)};var e=b.subscribe(function(){b.isModified(!0)});b._disposeValidation=function(){b.isValid.dispose(),b.rules.removeAll(),b.isModified._subscriptions.change=[],b.isValidating._subscriptions.change=[],b.__valid__._subscriptions.change=[],e.dispose(),d.dispose(),delete b.rules,delete b.error,delete b.isValid,delete b.isValidating,delete b.__valid__,delete b.isModified}}else c===!1&&a.validation.utils.isValidatable(b)&&b._disposeValidation&&b._disposeValidation();return b},a.validation.validateObservable=function(b){for(var e,f,g=0,h=b.rules(),i=h.length;i>g;g++)if(f=h[g],!f.condition||f.condition())if(e=a.validation.rules[f.rule],e.async||f.async)d(b,e,f);else if(!c(b,e,f))return!1;return b.error(null),b.__valid__(!0),!0},a.validation.localize=function(b){var c;for(c in b)a.validation.rules.hasOwnProperty(c)&&(a.validation.rules[c].message=b[c])},a.applyBindingsWithValidation=function(b,c,d){var e,f,g=arguments.length;g>2?(e=c,f=d):2>g?e=document.body:arguments[1].nodeType?e=c:f=arguments[1],a.validation.init(),f&&a.validation.utils.setDomData(e,f),a.applyBindings(b,c)};var h=a.applyBindings;a.applyBindings=function(b,c){a.validation.init(),h(b,c)},a.validatedObservable=function(b){if(!a.validation.utils.isObject(b))return a.observable(b).extend({validatable:!0});var c=a.observable(b);return c.errors=a.validation.group(b),c.isValid=a.computed(function(){return 0===c.errors().length}),c}});